// Minimal DOM sanitizer exposing window.DOMPurify.sanitize(html)
(function(){
  function sanitize(html){
    if(!html) return '';
    const allowedTags = new Set(['a','b','strong','i','em','code','pre','p','br','ul','ol','li','h1','h2','h3','span'])
    const wrapper = document.createElement('div')
    wrapper.innerHTML = html
    const walk = (node)=>{
      const toRemove = []
      node.childNodes.forEach(child=>{
        if(child.nodeType===1){
          const name = child.nodeName.toLowerCase()
          if(!allowedTags.has(name)){
            // unwrap but keep children
            const frag = document.createDocumentFragment()
            while(child.firstChild) frag.appendChild(child.firstChild)
            node.replaceChild(frag, child)
          } else {
            // strip attributes except href on <a>
            for(const attr of Array.from(child.attributes||[])){
              if(child.nodeName.toLowerCase()==='a' && attr.name==='href') continue
              child.removeAttribute(attr.name)
            }
            walk(child)
          }
        } else if(child.nodeType===3){
          // text node OK
        }
      })
    }
    walk(wrapper)
    return wrapper.innerHTML
  }
  window.DOMPurify = { sanitize }
})();
